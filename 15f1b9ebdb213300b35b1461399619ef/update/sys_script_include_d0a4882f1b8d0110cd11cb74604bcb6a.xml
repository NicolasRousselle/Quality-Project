<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>package_private</access>
        <active>true</active>
        <api_name>x_38181_qual_projt.Attachment</api_name>
        <caller_access/>
        <client_callable>false</client_callable>
        <description>Handler for attachment processing</description>
        <name>Attachment</name>
        <script><![CDATA[gs.include("PrototypeServer");

var Attachment = Class.create();
Attachment.prototype = {

   ATTACHMENT_INDEXED : 'attachment_index',
   ATTACHMENT_EXTRACTOR : 'attachment_extractor',
   ATTACHMENT_EXTENSION : 'extension', 
   
   initialize: function() {
      this.attachment = null;
   },
   
   setRecord: function(attachment) {
      this.attachment = attachment;
   },

   isIndexed: function() {
      if (this.attachment == null)
         return false;

      var gr = new GlideRecord(this.getTable());
      gr.initialize();
      if (!gr.isValid())
         return false;

      if (!gr.getED().getBooleanAttribute(this.ATTACHMENT_INDEXED))
         return false;

      if (!this._indexedType())
         return false;

      return true;
   },
   
   getTable: function() {
      return this.attachment.table_name.toString();
   },

   getTableID: function() {
      return this.attachment.table_sys_id.toString();
   },

   getTarget: function() {
      var gr = new GlideRecord(this.getTable());
      gr.get(this.getTableID());
      return gr;
   },

   getTerms: function(id) {
      var att = new GlideAttachmentIndexDocument(id);
      return att.getTerms(true);
   },

   _indexedType: function() {
      if (this.attachment == null)
         return false;

      var type = this.getType();
      return GlideAttachmentIndexTypes.isIndexed(type);
   },

   getType: function() {
      var att_name = this.attachment.file_name.toString();
      var att_parts = att_name.split(".");
      return att_parts[att_parts.length-1].toLowerCase();
   },
   
   setTargetTable: function(name) {
     this.tablename = name;
   },
   
   setTargetID: function(id) {
     this.targetID = id;
   },
   
   setTarget: function(gr) {
     this.target = gr;
   },
   
   setFilename: function(name) {
     this.filename = name;
   },
   
   setContentType: function(type) {
     this.contentType = type;
   },
   
   setValue: function(val) {
     this.value = val;
   },
   
   attach: function() {
     if(this.target == null) {
       //build target via gliderecord call
       if(this.tablename == null || this.targetID == null)
         return "Table name and/or target sys id are null. Please specify valid parameters.";
       var targetRecord = new GlideRecord(this.tablename);
       if(!targetRecord.get(this.targetID))
         return "Could not find a record in table '" + this.tablename + "' with sys_id '" + this.targetID + "'";
       this.setTarget(targetRecord);
     }
     
     var sa = new GlideSysAttachment();
     var attachmentId = sa.write(this.target, this.filename, this.contentType, this.value);
     if(attachmentId)
         return "Attachment created and attached to '"+ this.tablename+"' record with sys_id: '"+ this.targetID+"'";
     else
         return "Attachment creation failed";
   },
   
   write: function(gr, filename, content_type, value) {
     this.setTarget(gr);
     this.setFilename(filename);
     this.setContentType(content_type);
     this.setValue(value);
     return this.attach();
   },
   
   write: function(name, id, filename, content_type, value) {
     this.setTargetTable(name);
     this.setTargetID(id);
     this.setFilename(filename);
     this.setContentType(content_type);
     this.setValue(value);
     return this.attach();
   },
      
   type: 'Attachment'
}]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2022-01-20 10:04:49</sys_created_on>
        <sys_id>d0a4882f1b8d0110cd11cb74604bcb6a</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>Attachment</sys_name>
        <sys_package display_value="Scrum Quality Project" source="x_38181_qual_projt">15f1b9ebdb213300b35b1461399619ef</sys_package>
        <sys_policy/>
        <sys_scope display_value="Scrum Quality Project">15f1b9ebdb213300b35b1461399619ef</sys_scope>
        <sys_update_name>sys_script_include_d0a4882f1b8d0110cd11cb74604bcb6a</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2022-01-20 10:04:49</sys_updated_on>
    </sys_script_include>
</record_update>
